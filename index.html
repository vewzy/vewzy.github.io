<html>
  <head>
    <title>My Website Test</title>
  </head>
  <body>
    <canvas id="canvas"></canvas>
    <h1>Test</h1>
  </body>
  <style>
    * {
      margin: 0px;
      overscroll-behavior: none;
    }

    canvas {
    }
  </style>
  <script type="text/javascript">
    var can = document.getElementById("canvas");
    var dd = can.getContext("2d");

    can.width = 800;
    can.height = 600;
    
    var mousex, mousey
    var mousedown

    window.addEventListener("mousedown", function(e){
      console.log("mousedown");
      mousedown = 1;
    });

    // todo: some bugs with mouse and touch mixing during one isolated click
    window.addEventListener("mouseup", function(e){
      console.log("mouseup");
      mousedown = 0;
      segments.push(points);
      points = [];
    });
    
    window.addEventListener("mousemove", function (e) {
      // mousex = e.clientX;
      // mousey = e.clientY;
      if (mousedown) {
        console.log("mousemove, mousedown");
        mousex = e.clientX;
        mousey = e.clientY;
        points.push({x:mousex,y:mousey});
      }
    });
    
    window.addEventListener("touchmove", function (e) {
      if (mousedown) {
        console.log("touchmove, mousedown");
        mousex = e.changedTouches[0].pageX;
        mousey = e.changedTouches[0].pageY;
        points.push({x:mousex,y:mousey});
      }
    });

    window.addEventListener("touchstart", function(e){
      console.log("touchstart", e);
      mousedown = 1;
    });

    window.addEventListener("touchend", function(e){
      console.log("touchend", e);
      mousedown = 0;
      segments.push(points);
      points = [];
    });

    var points = [];
    var segments = []    

    function draw_loop () {

      dd.fillStyle = "rgb(247, 247, 247)";
      dd.fillRect(0, 0, can.width, can.height);

      dd.fillStyle = "rgb(0,0,0)";
      dd.fillRect(mousex, mousey, 5, 5);

      dd.beginPath();
      dd.strokeStyle = "rgb(255,0,255)";
      for (var i = 0; i < points.length; i++) {
        var p = points[i];
        dd.lineTo(p.x, p.y);
      }
      dd.stroke();

      for (var i = 0; i < segments.length; i++) {
        var s = segments[i];
        dd.beginPath();
        dd.strokeStyle = "black";
        for (var j = 0; j < s.length; j++) {
          var p = s[j];
          dd.lineTo(p.x, p.y);    
        }
      dd.stroke();
      }
      
      window.requestAnimationFrame(draw_loop);
    }
    draw_loop();
  </script>
</html>

